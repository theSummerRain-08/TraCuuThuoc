<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tra cứu thuốc tiêm truyền</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f2f6fa;
        margin: 0;
        text-align: center;
        padding-top: 70px;
        padding-left: 20px;
        padding-right: 20px;
        padding-bottom: 60px;
      }

      .page-title {
        color: #003366;
        margin-top: 80px;
      }

      #search {
        margin-top: 20px;
        margin-bottom: 10px;
      }

      input {
        width: 40%;
        padding: 10px;
        border: 2px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
      }

      .suggestions {
        width: 40%;
        margin: 0 auto;
        border: 1px solid #ccc;
        border-top: none;
        background: white;
        border-radius: 0 0 6px 6px;
        max-height: 200px;
        overflow-y: auto;
        text-align: left;
        position: relative;
        z-index: 999;
      }

      .suggestions div {
        padding: 10px;
        cursor: pointer;
      }

      .suggestions div:hover {
        background: #e6f0ff;
      }

      .result {
        margin: 40px auto;
        max-width: 900px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        overflow: hidden;
      }

      .section-title {
        background: #3b6b27;
        color: white;
        padding: 12px;
        font-weight: bold;
        text-align: center;
        font-size: 18px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
      }

      th {
        background: #cfe7ff;
        color: #001c55;
        width: 35%;
      }

      .row-blue {
        background: #cfe7ff;
        font-weight: bold;
        text-align: left;
      }

      img {
        max-width: 150px;
        margin: 10px 0;
      }

      a {
        color: #0066cc;
      }
    </style>
  </head>
  <body>
    <!-- HEADER SẼ LOAD TỪ header.html -->
    <div id="header-container"></div>

    <h1 class="page-title">TRA CỨU THUỐC TIÊM TRUYỀN VÀ THUỐC NGUY CƠ CAO</h1>

    <input
      type="text"
      id="search"
      placeholder="Nhập tên hoạt chất hoặc biệt dược..."
    />
    <div id="suggestions" class="suggestions"></div>

    <div class="result" id="result">
      <div class="section-title">THÔNG TIN KẾT QUẢ</div>
      <table id="info-table">
        <tr>
          <td colspan="2" style="text-align: center">Không có thông tin</td>
        </tr>
      </table>
    </div>

    <script>
      let data = [];
      const input = document.getElementById("search");
      const suggestions = document.getElementById("suggestions");
      const infoTable = document.getElementById("info-table");

      // TẢI DỮ LIỆU THUỐC
      fetch("data/thuoc-tiemtruyen.json")
        .then((res) => res.json())
        .then((json) => {
          data = json;
        });

      // GỢI Ý THEO CHỮ CÁI ĐẦU
      input.addEventListener("input", () => {
        const value = input.value.trim().toLowerCase();
        suggestions.innerHTML = "";

        if (value.length > 0) {
          const filtered = data
            .filter((item) => item.ten.toLowerCase().startsWith(value))
            .slice(0, 10);

          filtered.forEach((item) => {
            const div = document.createElement("div");
            div.textContent = item.ten;
            div.onclick = () => showDrugInfo(item);
            suggestions.appendChild(div);
          });
        }
      });

      function formatText(text) {
        if (!text) return "";
        return text.replace(/\/\//g, "<br>"); 
      }

      // HIỂN THỊ THÔNG TIN THUỐC
      function formatText(text) {
        if (!text) return "";
        return text.replace(/\/\//g, "<br>"); 
      }

      function showDrugInfo(item) {
        input.value = item.ten;
        suggestions.innerHTML = "";

        infoTable.innerHTML = `
    ${
      item.ten || item.biet_duoc || item.dang_bao_che || item.duong_tiem
        ? `
      <tr class="row-blue"><td colspan="2"><strong>ĐẶC ĐIỂM CHUNG CỦA THUỐC</strong></td></tr>
      ${
        item.ten
          ? `<tr><th>Hoạt chất</th><td>${formatText(item.ten)}</td></tr>`
          : ""
      }
      ${
        item.biet_duoc
          ? `<tr><th>Biệt dược</th><td>${formatText(item.biet_duoc)}</td></tr>`
          : ""
      }
      ${
        item.dang_bao_che
          ? `<tr><th>Dạng bào chế</th><td>${formatText(
              item.dang_bao_che
            )}</td></tr>`
          : ""
      }
      ${
        item.duong_tiem
          ? `<tr><th>Đường tiêm</th><td>${formatText(
              item.duong_tiem
            )}</td></tr>`
          : ""
      }
    `
        : ""
    }

    ${
      item.toc_do || item.luu_y
        ? `
      <tr class="row-blue"><td colspan="2"><strong>LƯU Ý VỀ TIÊM, TRUYỀN TĨNH MẠCH</strong></td></tr>
      ${
        item.toc_do
          ? `<tr><th>Tốc độ/Thời gian</th><td>${formatText(
              item.toc_do
            )}</td></tr>`
          : ""
      }
      ${
        item.luu_y
          ? `<tr><th>Lưu ý</th><td>${formatText(item.luu_y)}</td></tr>`
          : ""
      }
    `
        : ""
    }

    ${
      item.dung_moi_hoan_nguyen || item.cach_hoan_nguyen
        ? `
      <tr class="row-blue"><td colspan="2"><strong>CÁCH HOÀN NGUYÊN</strong></td></tr>
      ${
        item.dung_moi_hoan_nguyen
          ? `<tr><th>Dung môi hoàn nguyên</th><td>${formatText(
              item.dung_moi_hoan_nguyen
            )}</td></tr>`
          : ""
      }
      ${
        item.cach_hoan_nguyen
          ? `<tr><th>Cách hoàn nguyên</th><td>${formatText(
              item.cach_hoan_nguyen
            )}</td></tr>`
          : ""
      }
    `
        : ""
    }

    ${
      item.dung_moi_pha_loang || item.nong_do_kien_nghi
        ? `
      <tr class="row-blue"><td colspan="2"><strong>CÁCH PHA LOÃNG</strong></td></tr>
      ${
        item.dung_moi_pha_loang
          ? `<tr><th>Dung môi pha loãng</th><td>${formatText(
              item.dung_moi_pha_loang
            )}</td></tr>`
          : ""
      }
      ${
        item.nong_do_khuyen_nghi
          ? `<tr><th>Nồng độ khuyến nghị</th><td>${formatText(
              item.nong_do_khuyen_nghi
            )}</td></tr>`
          : ""
      }
    `
        : ""
    }

    ${
      item.tuong_ky
        ? `
      <tr class="row-blue"><td colspan="2"><strong>TƯƠNG HỢP - TƯƠNG KỊ</strong></td></tr>
      <tr><th>Tương kỵ</th><td>${formatText(item.tuong_ky)}</td></tr>
    `
        : ""
    }

    ${
      item.tai_lieu || item.hinh_anh
        ? `
      <tr class="row-blue"><td colspan="2"><strong>TÀI LIỆU THAM KHẢO</strong></td></tr>
      ${
        item.tai_lieu
          ? `<tr><th>Tham khảo</th><td><a href="${formatText(
              item.tai_lieu
            )}" target="_blank">Xem chi tiết</a></td></tr>`
          : ""
      }
      ${
        item.hinh_anh
          ? `<tr><th>Hình ảnh</th><td><img src="${formatText(
              item.hinh_anh
            )}" alt="Hình thuốc"></td></tr>`
          : ""
      }
    `
        : ""
    }
  `;
      }

      // ẨN GỢI Ý KHI CLICK RA NGOÀI
      document.addEventListener("click", (e) => {
        if (!suggestions.contains(e.target) && e.target !== input) {
          suggestions.innerHTML = "";
        }
      });
    </script>

    <!-- LOAD HEADER -->
    <script>
      fetch("header.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("header-container").innerHTML = html;
          initHeader();
        });

      function initHeader() {
        const menuBtn = document.querySelector(".menu-btn");
        const closeBtn = document.querySelector(".close-btn");
        const sideMenu = document.getElementById("sideMenu");
        const overlay = document.getElementById("overlay");

        if (!menuBtn) return;

        menuBtn.onclick = () => {
          sideMenu.classList.add("active");
          overlay.classList.add("active");
        };

        const closeMenu = () => {
          sideMenu.classList.remove("active");
          overlay.classList.remove("active");
        };

        closeBtn.onclick = closeMenu;
        overlay.onclick = closeMenu;
      }
    </script>
  </body>
</html>
